# 实验教学管理平台数据库设计方案

## 一、数据库设计原则

### 1.1 设计原则
- **规范化设计**: 遵循第三范式，减少数据冗余
- **性能优化**: 合理设计索引，优化查询性能
- **扩展性**: 预留扩展字段，支持业务发展
- **安全性**: 敏感数据加密，权限控制到字段级
- **一致性**: 统一命名规范，保持数据一致性

### 1.2 命名规范
- 表名：小写字母+下划线，复数形式（如：users, experiments）
- 字段名：小写字母+下划线（如：user_id, created_at）
- 索引名：idx_表名_字段名（如：idx_users_email）
- 外键名：fk_表名_字段名（如：fk_users_role_id）

## 二、核心数据表设计

### 2.1 组织架构相关表

#### 2.1.1 行政区域表 (administrative_regions)
```sql
CREATE TABLE administrative_regions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    code VARCHAR(20) NOT NULL COMMENT '区域代码',
    name VARCHAR(100) NOT NULL COMMENT '区域名称',
    level TINYINT NOT NULL COMMENT '级别：1省 2市 3区县 4学区',
    parent_id BIGINT UNSIGNED NULL COMMENT '父级ID',
    sort_order INT DEFAULT 0 COMMENT '排序',
    status TINYINT DEFAULT 1 COMMENT '状态：1启用 0禁用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_code (code),
    INDEX idx_parent_id (parent_id),
    INDEX idx_level (level)
) COMMENT='行政区域表';
```

#### 2.1.2 学校信息表 (schools)
```sql
CREATE TABLE schools (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    code VARCHAR(50) NOT NULL COMMENT '学校代码',
    name VARCHAR(200) NOT NULL COMMENT '学校名称',
    type TINYINT NOT NULL COMMENT '学校类型：1小学 2初中 3高中 4九年一贯制',
    level TINYINT NOT NULL COMMENT '管理级别：1省直 2市直 3区县直 4学区',
    region_id BIGINT UNSIGNED NOT NULL COMMENT '所属区域ID',
    address TEXT COMMENT '学校地址',
    contact_person VARCHAR(50) COMMENT '联系人',
    contact_phone VARCHAR(20) COMMENT '联系电话',
    student_count INT DEFAULT 0 COMMENT '学生总数',
    class_count INT DEFAULT 0 COMMENT '班级总数',
    teacher_count INT DEFAULT 0 COMMENT '教师总数',
    status TINYINT DEFAULT 1 COMMENT '状态：1正常 0停用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_code (code),
    INDEX idx_region_id (region_id),
    INDEX idx_type (type),
    INDEX idx_level (level)
) COMMENT='学校信息表';
```

### 2.2 用户权限相关表

#### 2.2.1 用户表 (users)
```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    email VARCHAR(100) COMMENT '邮箱',
    phone VARCHAR(20) COMMENT '手机号',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    real_name VARCHAR(50) NOT NULL COMMENT '真实姓名',
    avatar VARCHAR(255) COMMENT '头像',
    gender TINYINT COMMENT '性别：1男 2女',
    birthday DATE COMMENT '生日',
    id_card VARCHAR(18) COMMENT '身份证号',
    status TINYINT DEFAULT 1 COMMENT '状态：1正常 0禁用',
    last_login_at TIMESTAMP NULL COMMENT '最后登录时间',
    email_verified_at TIMESTAMP NULL COMMENT '邮箱验证时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_username (username),
    UNIQUE KEY uk_email (email),
    INDEX idx_phone (phone),
    INDEX idx_status (status)
) COMMENT='用户表';
```

#### 2.2.2 角色表 (roles)
```sql
CREATE TABLE roles (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL COMMENT '角色名称',
    code VARCHAR(50) NOT NULL COMMENT '角色代码',
    level TINYINT NOT NULL COMMENT '角色级别：1省级 2市级 3区县级 4学区级 5学校级',
    description TEXT COMMENT '角色描述',
    status TINYINT DEFAULT 1 COMMENT '状态：1启用 0禁用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_code (code),
    INDEX idx_level (level)
) COMMENT='角色表';
```

#### 2.2.3 用户角色关联表 (user_roles)
```sql
CREATE TABLE user_roles (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    role_id BIGINT UNSIGNED NOT NULL COMMENT '角色ID',
    scope_type VARCHAR(20) NOT NULL COMMENT '权限范围类型：region/school',
    scope_id BIGINT UNSIGNED NOT NULL COMMENT '权限范围ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_role_scope (user_id, role_id, scope_type, scope_id),
    INDEX idx_user_id (user_id),
    INDEX idx_role_id (role_id)
) COMMENT='用户角色关联表';
```

### 2.3 实验教学相关表

#### 2.3.1 学科表 (subjects)
```sql
CREATE TABLE subjects (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL COMMENT '学科名称',
    code VARCHAR(20) NOT NULL COMMENT '学科代码',
    category TINYINT NOT NULL COMMENT '学科类别：1理科 2文科 3综合',
    grade_range VARCHAR(20) COMMENT '适用年级范围',
    sort_order INT DEFAULT 0 COMMENT '排序',
    status TINYINT DEFAULT 1 COMMENT '状态：1启用 0禁用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_code (code),
    INDEX idx_category (category)
) COMMENT='学科表';
```

#### 2.3.2 实验目录表 (experiment_catalogs)
```sql
CREATE TABLE experiment_catalogs (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    subject_id BIGINT UNSIGNED NOT NULL COMMENT '学科ID',
    grade TINYINT NOT NULL COMMENT '年级',
    semester TINYINT NOT NULL COMMENT '学期：1上学期 2下学期',
    chapter VARCHAR(100) COMMENT '章节',
    name VARCHAR(200) NOT NULL COMMENT '实验名称',
    type TINYINT NOT NULL COMMENT '实验类型：1必做 2选做 3演示 4分组',
    difficulty TINYINT DEFAULT 1 COMMENT '难度系数：1-5',
    duration INT DEFAULT 45 COMMENT '实验时长(分钟)',
    student_count INT DEFAULT 1 COMMENT '每组学生数',
    description TEXT COMMENT '实验描述',
    objectives TEXT COMMENT '实验目标',
    procedures TEXT COMMENT '实验步骤',
    safety_notes TEXT COMMENT '安全注意事项',
    status TINYINT DEFAULT 1 COMMENT '状态：1启用 0禁用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_subject_grade (subject_id, grade),
    INDEX idx_type (type),
    INDEX idx_semester (semester)
) COMMENT='实验目录表';
```

#### 2.3.3 实验室表 (laboratories)
```sql
CREATE TABLE laboratories (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    school_id BIGINT UNSIGNED NOT NULL COMMENT '学校ID',
    name VARCHAR(100) NOT NULL COMMENT '实验室名称',
    code VARCHAR(50) COMMENT '实验室编号',
    type TINYINT NOT NULL COMMENT '实验室类型：1物理 2化学 3生物 4综合',
    area DECIMAL(8,2) COMMENT '面积(平方米)',
    capacity INT DEFAULT 50 COMMENT '容纳人数',
    floor VARCHAR(20) COMMENT '楼层',
    room_number VARCHAR(20) COMMENT '房间号',
    equipment_value DECIMAL(12,2) DEFAULT 0 COMMENT '设备总价值',
    manager_id BIGINT UNSIGNED COMMENT '管理员ID',
    status TINYINT DEFAULT 1 COMMENT '状态：1正常 2维修 0停用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_school_id (school_id),
    INDEX idx_type (type),
    INDEX idx_manager_id (manager_id)
) COMMENT='实验室表';
```

### 2.4 设备资产相关表

#### 2.4.1 设备分类表 (equipment_categories)
```sql
CREATE TABLE equipment_categories (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL COMMENT '分类名称',
    code VARCHAR(50) NOT NULL COMMENT '分类代码',
    parent_id BIGINT UNSIGNED NULL COMMENT '父分类ID',
    level TINYINT NOT NULL COMMENT '分类级别',
    sort_order INT DEFAULT 0 COMMENT '排序',
    status TINYINT DEFAULT 1 COMMENT '状态：1启用 0禁用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_code (code),
    INDEX idx_parent_id (parent_id)
) COMMENT='设备分类表';
```

#### 2.4.2 设备信息表 (equipments)
```sql
CREATE TABLE equipments (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    school_id BIGINT UNSIGNED NOT NULL COMMENT '学校ID',
    laboratory_id BIGINT UNSIGNED COMMENT '实验室ID',
    category_id BIGINT UNSIGNED NOT NULL COMMENT '分类ID',
    name VARCHAR(200) NOT NULL COMMENT '设备名称',
    code VARCHAR(100) COMMENT '设备编号',
    model VARCHAR(100) COMMENT '型号规格',
    brand VARCHAR(100) COMMENT '品牌',
    supplier VARCHAR(200) COMMENT '供应商',
    supplier_phone VARCHAR(20) COMMENT '供应商电话',
    purchase_date DATE COMMENT '购入日期',
    purchase_price DECIMAL(10,2) COMMENT '购入价格',
    quantity INT NOT NULL DEFAULT 1 COMMENT '数量',
    unit VARCHAR(20) DEFAULT '台' COMMENT '单位',
    warranty_period INT COMMENT '保修期(月)',
    service_life INT COMMENT '使用年限(年)',
    funding_source VARCHAR(100) COMMENT '经费来源',
    storage_location VARCHAR(200) COMMENT '存放位置',
    manager_id BIGINT UNSIGNED COMMENT '保管人ID',
    status TINYINT DEFAULT 1 COMMENT '状态：1正常 2维修 3报废 0停用',
    qr_code VARCHAR(255) COMMENT '二维码',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_school_id (school_id),
    INDEX idx_laboratory_id (laboratory_id),
    INDEX idx_category_id (category_id),
    INDEX idx_code (code),
    INDEX idx_manager_id (manager_id),
    INDEX idx_status (status)
) COMMENT='设备信息表';
```

### 2.5 实验记录相关表

#### 2.5.1 实验预约表 (experiment_reservations)
```sql
CREATE TABLE experiment_reservations (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    school_id BIGINT UNSIGNED NOT NULL COMMENT '学校ID',
    catalog_id BIGINT UNSIGNED NOT NULL COMMENT '实验目录ID',
    laboratory_id BIGINT UNSIGNED NOT NULL COMMENT '实验室ID',
    teacher_id BIGINT UNSIGNED NOT NULL COMMENT '授课教师ID',
    class_name VARCHAR(100) NOT NULL COMMENT '班级名称',
    student_count INT NOT NULL COMMENT '学生人数',
    reservation_date DATE NOT NULL COMMENT '预约日期',
    start_time TIME NOT NULL COMMENT '开始时间',
    end_time TIME NOT NULL COMMENT '结束时间',
    status TINYINT DEFAULT 1 COMMENT '状态：1待审核 2已通过 3已拒绝 4已完成 5已取消',
    remark TEXT COMMENT '备注',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_school_id (school_id),
    INDEX idx_catalog_id (catalog_id),
    INDEX idx_laboratory_id (laboratory_id),
    INDEX idx_teacher_id (teacher_id),
    INDEX idx_reservation_date (reservation_date),
    INDEX idx_status (status)
) COMMENT='实验预约表';
```

#### 2.5.2 实验记录表 (experiment_records)
```sql
CREATE TABLE experiment_records (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    reservation_id BIGINT UNSIGNED NOT NULL COMMENT '预约ID',
    school_id BIGINT UNSIGNED NOT NULL COMMENT '学校ID',
    catalog_id BIGINT UNSIGNED NOT NULL COMMENT '实验目录ID',
    laboratory_id BIGINT UNSIGNED NOT NULL COMMENT '实验室ID',
    teacher_id BIGINT UNSIGNED NOT NULL COMMENT '授课教师ID',
    class_name VARCHAR(100) NOT NULL COMMENT '班级名称',
    student_count INT NOT NULL COMMENT '实际学生人数',
    start_time DATETIME COMMENT '实际开始时间',
    end_time DATETIME COMMENT '实际结束时间',
    completion_rate DECIMAL(5,2) DEFAULT 100.00 COMMENT '完成率(%)',
    quality_score TINYINT COMMENT '质量评分(1-5)',
    photos JSON COMMENT '实验照片',
    videos JSON COMMENT '实验视频',
    summary TEXT COMMENT '实验总结',
    problems TEXT COMMENT '存在问题',
    suggestions TEXT COMMENT '改进建议',
    status TINYINT DEFAULT 1 COMMENT '状态：1进行中 2已完成 3异常结束',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_reservation_id (reservation_id),
    INDEX idx_school_id (school_id),
    INDEX idx_catalog_id (catalog_id),
    INDEX idx_teacher_id (teacher_id),
    INDEX idx_start_time (start_time)
) COMMENT='实验记录表';
```

## 三、统计分析相关表

### 3.1 统计汇总表 (statistics_summary)
```sql
CREATE TABLE statistics_summary (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    scope_type VARCHAR(20) NOT NULL COMMENT '统计范围：province/city/county/district/school',
    scope_id BIGINT UNSIGNED NOT NULL COMMENT '范围ID',
    subject_id BIGINT UNSIGNED COMMENT '学科ID',
    stat_date DATE NOT NULL COMMENT '统计日期',
    stat_type VARCHAR(50) NOT NULL COMMENT '统计类型',
    total_experiments INT DEFAULT 0 COMMENT '总实验数',
    completed_experiments INT DEFAULT 0 COMMENT '已完成实验数',
    completion_rate DECIMAL(5,2) DEFAULT 0 COMMENT '完成率',
    group_experiments INT DEFAULT 0 COMMENT '分组实验数',
    demo_experiments INT DEFAULT 0 COMMENT '演示实验数',
    total_value DECIMAL(15,2) DEFAULT 0 COMMENT '总价值',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_scope_subject_date_type (scope_type, scope_id, subject_id, stat_date, stat_type),
    INDEX idx_stat_date (stat_date),
    INDEX idx_stat_type (stat_type)
) COMMENT='统计汇总表';
```

## 四、系统配置相关表

### 4.1 系统配置表 (system_configs)
```sql
CREATE TABLE system_configs (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    key_name VARCHAR(100) NOT NULL COMMENT '配置键',
    key_value TEXT COMMENT '配置值',
    description VARCHAR(255) COMMENT '配置描述',
    type VARCHAR(20) DEFAULT 'string' COMMENT '数据类型',
    group_name VARCHAR(50) COMMENT '配置分组',
    sort_order INT DEFAULT 0 COMMENT '排序',
    is_system TINYINT DEFAULT 0 COMMENT '是否系统配置',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_key_name (key_name),
    INDEX idx_group_name (group_name)
) COMMENT='系统配置表';
```

### 4.2 操作日志表 (operation_logs)
```sql
CREATE TABLE operation_logs (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED COMMENT '操作用户ID',
    module VARCHAR(50) NOT NULL COMMENT '操作模块',
    action VARCHAR(50) NOT NULL COMMENT '操作动作',
    description TEXT COMMENT '操作描述',
    request_data JSON COMMENT '请求数据',
    response_data JSON COMMENT '响应数据',
    ip_address VARCHAR(45) COMMENT 'IP地址',
    user_agent TEXT COMMENT '用户代理',
    execution_time INT COMMENT '执行时间(毫秒)',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_module (module),
    INDEX idx_action (action),
    INDEX idx_created_at (created_at)
) COMMENT='操作日志表';
```

## 五、数据字典

### 5.1 枚举值定义

#### 用户状态
- 1: 正常
- 0: 禁用

#### 学校类型
- 1: 小学
- 2: 初中  
- 3: 高中
- 4: 九年一贯制

#### 实验类型
- 1: 必做实验
- 2: 选做实验
- 3: 演示实验
- 4: 分组实验

#### 设备状态
- 1: 正常
- 2: 维修中
- 3: 已报废
- 0: 停用

### 5.2 索引策略
- 主键索引：所有表的id字段
- 唯一索引：业务唯一字段（如用户名、设备编号等）
- 普通索引：查询频繁的字段（如状态、时间等）
- 复合索引：多字段组合查询（如学校+学科+年级）

## 六、数据库优化建议

### 6.1 性能优化
- 合理设计索引，避免过多索引影响写入性能
- 大表考虑分区策略（按时间或地区分区）
- 历史数据定期归档，保持主表数据量适中
- 统计数据使用汇总表，避免实时计算

### 6.2 扩展性设计
- 预留扩展字段（如extra_data JSON字段）
- 支持软删除（deleted_at字段）
- 版本控制字段（version字段）
- 审计字段（created_by, updated_by）

---

**文档版本**: v1.0  
**创建日期**: 2025-01-13  
**更新日期**: 2025-01-13  
**文档状态**: 初稿
