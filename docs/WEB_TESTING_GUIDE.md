# 组织层级权限控制系统网页测试指南

## 测试前准备

### 1. 确保服务运行
```bash
# 启动后端服务
cd backend
php artisan serve

# 启动前端服务
cd frontend
npm run dev
```

### 2. 确保数据库已更新
```bash
cd backend

# 运行数据库迁移
php artisan migrate

# 创建测试数据
php artisan db:seed --class=OrganizationPermissionSeeder
php artisan db:seed --class=TestEquipmentSeeder
```

### 3. 验证测试用户
运行权限测试脚本确认测试用户已创建：
```bash
php test_organization_permissions.php
```

## 测试用户账号

系统已创建以下测试用户，密码均为：`password`

| 用户名 | 角色 | 组织级别 | 管理范围 | 具体组织 |
|--------|------|----------|----------|----------|
| province_admin_test | 省级管理员 | 1 | 全省数据 | 河北省教育厅 |
| city_admin_test | 市级管理员 | 2 | 本市及下级 | 石家庄市教育局 |
| county_admin_test | 区县管理员 | 3 | 本区县及下级 | 藁城区教育局 |
| district_admin_test | 学区管理员 | 4 | 本学区学校 | 廉州学区 |
| school_admin_test | 学校管理员 | 5 | 本校数据 | 廉州东城小学 |
| province_school_admin | 学校管理员 | 5 | 本校数据 | 石家庄精英中学 |
| city_school_admin | 学校管理员 | 5 | 本校数据 | 石家庄市第一中学 |
| county_school_admin | 学校管理员 | 5 | 本校数据 | 通安小学 |

## 测试步骤

### 第一步：省级管理员测试

1. **登录系统**
   - 用户名：`province_admin_test`
   - 密码：`password`

2. **验证菜单权限**
   - ✅ 应该看到所有菜单项
   - ✅ 包括"行政区域管理"菜单

3. **测试设备管理**
   - 进入"设备管理" → "设备档案"
   - ✅ 应该看到所有学校的设备（预期：20台设备）
   - ✅ 可以查看不同学校的设备详情
   - ✅ 可以创建、编辑、删除任意学校的设备

4. **测试学校管理**
   - 进入"基础数据" → "学校管理"
   - ✅ 应该看到所有学校（预期：4所学校）
   - ✅ 可以查看、编辑任意学校信息

5. **测试用户管理**
   - 进入"用户管理" → "用户列表"
   - ✅ 应该看到所有级别的用户
   - ✅ 可以管理所有用户

### 第二步：市级管理员测试

1. **登录系统**
   - 用户名：`city_admin_test`
   - 密码：`password`

2. **验证数据范围**
   - 进入"设备管理" → "设备档案"
   - ✅ 应该看到市直和区县学校的设备（预期：15台设备）
   - ❌ 不应该看到省直学校的设备

3. **测试学校管理**
   - 进入"基础数据" → "学校管理"
   - ✅ 应该看到市直和区县学校（预期：3所学校）
   - ❌ 不应该看到省直学校

4. **测试权限边界**
   - 尝试直接访问省直学校的设备详情页
   - ✅ 应该返回403权限错误

### 第三步：区县管理员测试

1. **登录系统**
   - 用户名：`county_admin_test`
   - 密码：`password`

2. **验证数据范围**
   - 进入"设备管理" → "设备档案"
   - ✅ 应该看到区县直和学区学校的设备（预期：10台设备）
   - ❌ 不应该看到省直、市直学校的设备

3. **测试学校管理**
   - 进入"基础数据" → "学校管理"
   - ✅ 应该看到区县直和学区学校（预期：2所学校）

### 第四步：学区管理员测试

1. **登录系统**
   - 用户名：`district_admin_test`
   - 密码：`password`

2. **验证数据范围**
   - 进入"设备管理" → "设备档案"
   - ✅ 应该只看到学区内学校的设备（预期：5台设备）

3. **验证菜单限制**
   - ❌ 不应该看到"行政区域管理"菜单
   - ✅ 可以看到"学校管理"但只显示学区内学校

### 第五步：学校管理员测试

1. **登录系统**
   - 用户名：`school_admin_test`
   - 密码：`password`

2. **验证数据范围**
   - 进入"设备管理" → "设备档案"
   - ✅ 应该只看到本校设备（预期：5台设备）

3. **测试实验室管理**
   - 进入"基础数据" → "实验室管理"
   - ✅ 应该只看到本校实验室

4. **验证权限限制**
   - ❌ 不应该看到"角色管理"和"权限管理"菜单
   - ❌ 不应该看到"行政区域管理"菜单

## 关键测试点

### 1. 数据权限验证
- **设备数量检查**：不同级别用户看到的设备数量应该符合预期
- **学校列表检查**：用户只能看到权限范围内的学校
- **详情页访问**：尝试访问权限外的资源应返回403错误

### 2. 菜单权限验证
- **行政区域管理**：只有省级、市级、区县级用户可见
- **角色权限管理**：只有省级、市级用户可见
- **用户管理**：所有管理员可见，但数据范围不同

### 3. 操作权限验证
- **创建资源**：只能在权限范围内的组织下创建
- **编辑资源**：只能编辑权限范围内的资源
- **删除资源**：只能删除权限范围内的资源

### 4. API权限验证
打开浏览器开发者工具，检查API请求：
- 所有API请求都应该包含认证头
- 返回的数据应该符合用户权限范围
- 权限外的请求应该返回403状态码

## 预期测试结果

### 设备数量分布
- **省级管理员**：20台设备（全部）
- **市级管理员**：15台设备（市直+区县+学区）
- **区县管理员**：10台设备（区县直+学区）
- **学区管理员**：5台设备（仅学区）
- **学校管理员**：5台设备（仅本校）

### 学校数量分布
- **省级管理员**：4所学校（全部）
- **市级管理员**：3所学校（市直+区县+学区）
- **区县管理员**：2所学校（区县直+学区）
- **学区管理员**：1所学校（仅学区）
- **学校管理员**：1所学校（仅本校）

## 故障排除

### 常见问题
1. **登录失败**：检查用户是否已创建，密码是否正确
2. **数据为空**：检查是否运行了种子数据脚本
3. **权限异常**：检查用户的组织归属配置
4. **API错误**：检查后端服务是否正常运行

### 调试方法
1. **查看浏览器控制台**：检查JavaScript错误和API响应
2. **查看网络请求**：确认API请求和响应内容
3. **查看后端日志**：检查Laravel日志文件
4. **运行测试脚本**：使用命令行测试脚本验证权限逻辑

## 测试完成标准

✅ 所有测试用户都能正常登录
✅ 不同级别用户看到的数据数量符合预期
✅ 菜单权限控制正确
✅ 权限边界验证有效（403错误正常返回）
✅ 创建、编辑、删除操作的权限控制正确
✅ API层面的权限过滤正常工作

完成以上测试后，组织层级权限控制系统即可投入使用。
