# 实验教学管理平台前端组件设计文档

## 一、前端架构设计

### 1.1 技术栈
- **框架**: Vue 3 + Composition API
- **UI组件库**: Element Plus
- **状态管理**: Pinia
- **路由管理**: Vue Router 4
- **构建工具**: Vite
- **HTTP客户端**: Axios
- **图表库**: ECharts
- **地图组件**: 高德地图/百度地图
- **工具库**: Lodash, Day.js

### 1.2 项目结构
```
src/
├── api/                    # API接口
│   ├── auth.js
│   ├── user.js
│   ├── experiment.js
│   └── equipment.js
├── assets/                 # 静态资源
│   ├── images/
│   ├── icons/
│   └── styles/
├── components/             # 公共组件
│   ├── common/            # 通用组件
│   ├── form/              # 表单组件
│   ├── table/             # 表格组件
│   └── chart/             # 图表组件
├── composables/           # 组合式函数
│   ├── useAuth.js
│   ├── usePermission.js
│   └── useTable.js
├── layouts/               # 布局组件
│   ├── DefaultLayout.vue
│   ├── AuthLayout.vue
│   └── MobileLayout.vue
├── pages/                 # 页面组件
│   ├── auth/              # 认证页面
│   ├── dashboard/         # 仪表盘
│   ├── user/              # 用户管理
│   ├── experiment/        # 实验管理
│   ├── equipment/         # 设备管理
│   └── statistics/        # 统计分析
├── router/                # 路由配置
│   ├── index.js
│   └── modules/
├── stores/                # 状态管理
│   ├── auth.js
│   ├── user.js
│   └── app.js
├── utils/                 # 工具函数
│   ├── request.js
│   ├── permission.js
│   └── common.js
├── App.vue
└── main.js
```

### 1.3 组件设计原则
- **单一职责**: 每个组件只负责一个功能
- **可复用性**: 组件设计要考虑复用场景
- **可配置性**: 通过props提供灵活配置
- **响应式设计**: 适配不同屏幕尺寸
- **无障碍访问**: 支持键盘导航和屏幕阅读器

## 二、核心组件设计

### 2.1 布局组件

#### 2.1.1 主布局组件 (DefaultLayout.vue)
```vue
<template>
  <el-container class="app-container">
    <!-- 顶部导航 -->
    <el-header class="app-header">
      <AppHeader />
    </el-header>
    
    <el-container>
      <!-- 侧边栏 -->
      <el-aside :width="sidebarWidth" class="app-sidebar">
        <AppSidebar />
      </el-aside>
      
      <!-- 主内容区 -->
      <el-main class="app-main">
        <AppBreadcrumb />
        <router-view />
      </el-main>
    </el-container>
  </el-container>
</template>

<script setup>
import { computed } from 'vue'
import { useAppStore } from '@/stores/app'
import AppHeader from './components/AppHeader.vue'
import AppSidebar from './components/AppSidebar.vue'
import AppBreadcrumb from './components/AppBreadcrumb.vue'

const appStore = useAppStore()

const sidebarWidth = computed(() => {
  return appStore.sidebarCollapsed ? '64px' : '200px'
})
</script>
```

#### 2.1.2 顶部导航组件 (AppHeader.vue)
```vue
<template>
  <div class="app-header-content">
    <!-- 左侧 -->
    <div class="header-left">
      <el-button 
        :icon="Fold" 
        text 
        @click="toggleSidebar"
      />
      <span class="app-title">实验教学管理平台</span>
    </div>
    
    <!-- 右侧 -->
    <div class="header-right">
      <!-- 消息通知 -->
      <el-badge :value="unreadCount" class="header-item">
        <el-button :icon="Bell" text />
      </el-badge>
      
      <!-- 用户菜单 -->
      <el-dropdown class="header-item">
        <div class="user-info">
          <el-avatar :src="userInfo.avatar" />
          <span class="username">{{ userInfo.real_name }}</span>
        </div>
        <template #dropdown>
          <el-dropdown-menu>
            <el-dropdown-item @click="showProfile">个人资料</el-dropdown-item>
            <el-dropdown-item @click="changePassword">修改密码</el-dropdown-item>
            <el-dropdown-item divided @click="logout">退出登录</el-dropdown-item>
          </el-dropdown-menu>
        </template>
      </el-dropdown>
    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { Fold, Bell } from '@element-plus/icons-vue'
import { useAuthStore } from '@/stores/auth'
import { useAppStore } from '@/stores/app'

const authStore = useAuthStore()
const appStore = useAppStore()

const userInfo = computed(() => authStore.userInfo)
const unreadCount = computed(() => appStore.unreadCount)

const toggleSidebar = () => {
  appStore.toggleSidebar()
}

const logout = () => {
  authStore.logout()
}
</script>
```

### 2.2 表格组件

#### 2.2.1 数据表格组件 (DataTable.vue)
```vue
<template>
  <div class="data-table">
    <!-- 搜索栏 -->
    <div v-if="showSearch" class="table-search">
      <slot name="search" :search="search" :reset="reset" />
    </div>
    
    <!-- 工具栏 -->
    <div v-if="showToolbar" class="table-toolbar">
      <div class="toolbar-left">
        <slot name="toolbar-left" />
      </div>
      <div class="toolbar-right">
        <el-button :icon="Refresh" @click="refresh">刷新</el-button>
        <slot name="toolbar-right" />
      </div>
    </div>
    
    <!-- 表格 -->
    <el-table
      v-loading="loading"
      :data="tableData"
      :height="tableHeight"
      @selection-change="handleSelectionChange"
      @sort-change="handleSortChange"
    >
      <el-table-column
        v-if="showSelection"
        type="selection"
        width="55"
      />
      
      <slot />
      
      <el-table-column
        v-if="showActions"
        label="操作"
        :width="actionWidth"
        fixed="right"
      >
        <template #default="scope">
          <slot name="actions" :row="scope.row" :index="scope.$index" />
        </template>
      </el-table-column>
    </el-table>
    
    <!-- 分页 -->
    <div v-if="showPagination" class="table-pagination">
      <el-pagination
        v-model:current-page="pagination.current_page"
        v-model:page-size="pagination.per_page"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
      />
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { Refresh } from '@element-plus/icons-vue'

const props = defineProps({
  api: {
    type: Function,
    required: true
  },
  params: {
    type: Object,
    default: () => ({})
  },
  showSearch: {
    type: Boolean,
    default: true
  },
  showToolbar: {
    type: Boolean,
    default: true
  },
  showSelection: {
    type: Boolean,
    default: false
  },
  showActions: {
    type: Boolean,
    default: true
  },
  showPagination: {
    type: Boolean,
    default: true
  },
  actionWidth: {
    type: [String, Number],
    default: 150
  },
  tableHeight: {
    type: [String, Number],
    default: 'auto'
  }
})

const emit = defineEmits(['selection-change', 'refresh'])

const loading = ref(false)
const tableData = ref([])
const selectedRows = ref([])
const pagination = ref({
  current_page: 1,
  per_page: 20,
  total: 0
})

// 加载数据
const loadData = async () => {
  loading.value = true
  try {
    const params = {
      ...props.params,
      page: pagination.value.current_page,
      per_page: pagination.value.per_page
    }
    
    const response = await props.api(params)
    tableData.value = response.data.items
    pagination.value = response.data.pagination
  } catch (error) {
    console.error('加载数据失败:', error)
  } finally {
    loading.value = false
  }
}

// 刷新数据
const refresh = () => {
  loadData()
  emit('refresh')
}

// 搜索
const search = () => {
  pagination.value.current_page = 1
  loadData()
}

// 重置
const reset = () => {
  pagination.value.current_page = 1
  loadData()
}

// 选择变化
const handleSelectionChange = (selection) => {
  selectedRows.value = selection
  emit('selection-change', selection)
}

// 排序变化
const handleSortChange = ({ prop, order }) => {
  // 处理排序逻辑
  loadData()
}

// 页码变化
const handleCurrentChange = () => {
  loadData()
}

// 页大小变化
const handleSizeChange = () => {
  pagination.value.current_page = 1
  loadData()
}

onMounted(() => {
  loadData()
})

defineExpose({
  refresh,
  selectedRows
})
</script>
```

### 2.3 表单组件

#### 2.3.1 动态表单组件 (DynamicForm.vue)
```vue
<template>
  <el-form
    ref="formRef"
    :model="formData"
    :rules="formRules"
    :label-width="labelWidth"
    :size="size"
  >
    <template v-for="field in fields" :key="field.prop">
      <el-form-item
        :label="field.label"
        :prop="field.prop"
        :required="field.required"
      >
        <!-- 输入框 -->
        <el-input
          v-if="field.type === 'input'"
          v-model="formData[field.prop]"
          :placeholder="field.placeholder"
          :disabled="field.disabled"
          :maxlength="field.maxlength"
          :show-word-limit="field.showWordLimit"
        />
        
        <!-- 数字输入框 -->
        <el-input-number
          v-else-if="field.type === 'number'"
          v-model="formData[field.prop]"
          :min="field.min"
          :max="field.max"
          :step="field.step"
          :precision="field.precision"
          :disabled="field.disabled"
        />
        
        <!-- 选择器 -->
        <el-select
          v-else-if="field.type === 'select'"
          v-model="formData[field.prop]"
          :placeholder="field.placeholder"
          :disabled="field.disabled"
          :multiple="field.multiple"
          :clearable="field.clearable"
        >
          <el-option
            v-for="option in field.options"
            :key="option.value"
            :label="option.label"
            :value="option.value"
          />
        </el-select>
        
        <!-- 日期选择器 -->
        <el-date-picker
          v-else-if="field.type === 'date'"
          v-model="formData[field.prop]"
          :type="field.dateType || 'date'"
          :placeholder="field.placeholder"
          :disabled="field.disabled"
          :format="field.format"
          :value-format="field.valueFormat"
        />
        
        <!-- 文本域 -->
        <el-input
          v-else-if="field.type === 'textarea'"
          v-model="formData[field.prop]"
          type="textarea"
          :placeholder="field.placeholder"
          :disabled="field.disabled"
          :rows="field.rows || 3"
          :maxlength="field.maxlength"
          :show-word-limit="field.showWordLimit"
        />
        
        <!-- 开关 -->
        <el-switch
          v-else-if="field.type === 'switch'"
          v-model="formData[field.prop]"
          :disabled="field.disabled"
          :active-text="field.activeText"
          :inactive-text="field.inactiveText"
        />
        
        <!-- 单选框组 -->
        <el-radio-group
          v-else-if="field.type === 'radio'"
          v-model="formData[field.prop]"
          :disabled="field.disabled"
        >
          <el-radio
            v-for="option in field.options"
            :key="option.value"
            :label="option.value"
          >
            {{ option.label }}
          </el-radio>
        </el-radio-group>
        
        <!-- 复选框组 -->
        <el-checkbox-group
          v-else-if="field.type === 'checkbox'"
          v-model="formData[field.prop]"
          :disabled="field.disabled"
        >
          <el-checkbox
            v-for="option in field.options"
            :key="option.value"
            :label="option.value"
          >
            {{ option.label }}
          </el-checkbox>
        </el-checkbox-group>
        
        <!-- 文件上传 -->
        <FileUpload
          v-else-if="field.type === 'upload'"
          v-model="formData[field.prop]"
          :accept="field.accept"
          :multiple="field.multiple"
          :limit="field.limit"
          :disabled="field.disabled"
        />
      </el-form-item>
    </template>
    
    <el-form-item v-if="showButtons">
      <el-button type="primary" @click="submit">{{ submitText }}</el-button>
      <el-button @click="reset">{{ resetText }}</el-button>
      <slot name="buttons" />
    </el-form-item>
  </el-form>
</template>

<script setup>
import { ref, reactive, watch } from 'vue'
import FileUpload from './FileUpload.vue'

const props = defineProps({
  fields: {
    type: Array,
    required: true
  },
  modelValue: {
    type: Object,
    default: () => ({})
  },
  labelWidth: {
    type: String,
    default: '120px'
  },
  size: {
    type: String,
    default: 'default'
  },
  showButtons: {
    type: Boolean,
    default: true
  },
  submitText: {
    type: String,
    default: '提交'
  },
  resetText: {
    type: String,
    default: '重置'
  }
})

const emit = defineEmits(['update:modelValue', 'submit', 'reset'])

const formRef = ref()
const formData = reactive({ ...props.modelValue })

// 生成表单验证规则
const formRules = computed(() => {
  const rules = {}
  props.fields.forEach(field => {
    if (field.rules) {
      rules[field.prop] = field.rules
    } else if (field.required) {
      rules[field.prop] = [
        { required: true, message: `请输入${field.label}`, trigger: 'blur' }
      ]
    }
  })
  return rules
})

// 监听表单数据变化
watch(formData, (newVal) => {
  emit('update:modelValue', newVal)
}, { deep: true })

// 提交表单
const submit = async () => {
  try {
    await formRef.value.validate()
    emit('submit', formData)
  } catch (error) {
    console.error('表单验证失败:', error)
  }
}

// 重置表单
const reset = () => {
  formRef.value.resetFields()
  emit('reset')
}

defineExpose({
  validate: () => formRef.value.validate(),
  resetFields: () => formRef.value.resetFields(),
  clearValidate: () => formRef.value.clearValidate()
})
</script>
```

### 2.4 图表组件

#### 2.4.1 ECharts封装组件 (BaseChart.vue)
```vue
<template>
  <div
    ref="chartRef"
    :style="{ width, height }"
    class="base-chart"
  />
</template>

<script setup>
import { ref, onMounted, onUnmounted, watch, nextTick } from 'vue'
import * as echarts from 'echarts'

const props = defineProps({
  option: {
    type: Object,
    required: true
  },
  width: {
    type: String,
    default: '100%'
  },
  height: {
    type: String,
    default: '400px'
  },
  theme: {
    type: String,
    default: 'default'
  }
})

const chartRef = ref()
let chartInstance = null

// 初始化图表
const initChart = () => {
  if (!chartRef.value) return
  
  chartInstance = echarts.init(chartRef.value, props.theme)
  chartInstance.setOption(props.option)
  
  // 监听窗口大小变化
  window.addEventListener('resize', handleResize)
}

// 更新图表
const updateChart = () => {
  if (chartInstance) {
    chartInstance.setOption(props.option, true)
  }
}

// 处理窗口大小变化
const handleResize = () => {
  if (chartInstance) {
    chartInstance.resize()
  }
}

// 监听配置变化
watch(() => props.option, updateChart, { deep: true })

onMounted(() => {
  nextTick(() => {
    initChart()
  })
})

onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose()
    window.removeEventListener('resize', handleResize)
  }
})

defineExpose({
  getInstance: () => chartInstance,
  resize: handleResize
})
</script>
```

## 三、页面组件设计

### 3.1 仪表盘页面 (Dashboard.vue)
```vue
<template>
  <div class="dashboard">
    <!-- 统计卡片 -->
    <el-row :gutter="20" class="stats-cards">
      <el-col :span="6" v-for="stat in statsData" :key="stat.key">
        <el-card class="stat-card">
          <div class="stat-content">
            <div class="stat-icon">
              <el-icon :size="40" :color="stat.color">
                <component :is="stat.icon" />
              </el-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{ stat.value }}</div>
              <div class="stat-label">{{ stat.label }}</div>
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>
    
    <!-- 图表区域 -->
    <el-row :gutter="20" class="chart-section">
      <el-col :span="12">
        <el-card title="实验开出率趋势">
          <BaseChart :option="completionTrendOption" height="300px" />
        </el-card>
      </el-col>
      <el-col :span="12">
        <el-card title="学科分布">
          <BaseChart :option="subjectDistributionOption" height="300px" />
        </el-card>
      </el-col>
    </el-row>
    
    <!-- 地图分析 -->
    <el-row class="map-section">
      <el-col :span="24">
        <el-card title="区域分析">
          <RegionMap :data="regionData" />
        </el-card>
      </el-col>
    </el-row>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { School, Experiment, Equipment, TrendCharts } from '@element-plus/icons-vue'
import BaseChart from '@/components/chart/BaseChart.vue'
import RegionMap from '@/components/chart/RegionMap.vue'
import { getDashboardStats } from '@/api/dashboard'

const statsData = ref([
  { key: 'schools', label: '学校总数', value: 0, icon: School, color: '#409EFF' },
  { key: 'experiments', label: '实验总数', value: 0, icon: Experiment, color: '#67C23A' },
  { key: 'equipments', label: '设备总数', value: 0, icon: Equipment, color: '#E6A23C' },
  { key: 'completion_rate', label: '开出率', value: '0%', icon: TrendCharts, color: '#F56C6C' }
])

const completionTrendOption = ref({})
const subjectDistributionOption = ref({})
const regionData = ref([])

// 加载仪表盘数据
const loadDashboardData = async () => {
  try {
    const response = await getDashboardStats()
    const data = response.data
    
    // 更新统计数据
    statsData.value.forEach(stat => {
      stat.value = data.stats[stat.key]
    })
    
    // 更新图表数据
    completionTrendOption.value = data.charts.completion_trend
    subjectDistributionOption.value = data.charts.subject_distribution
    regionData.value = data.region_data
  } catch (error) {
    console.error('加载仪表盘数据失败:', error)
  }
}

onMounted(() => {
  loadDashboardData()
})
</script>
```

## 四、移动端适配

### 4.1 响应式设计
```scss
// 响应式断点
$mobile: 768px;
$tablet: 1024px;
$desktop: 1200px;

// 移动端适配
@media (max-width: $mobile) {
  .app-container {
    .app-sidebar {
      position: fixed;
      left: -200px;
      transition: left 0.3s;
      z-index: 1000;
      
      &.mobile-open {
        left: 0;
      }
    }
    
    .app-main {
      margin-left: 0;
      padding: 10px;
    }
  }
  
  .stats-cards {
    .el-col {
      margin-bottom: 15px;
    }
  }
  
  .data-table {
    .table-toolbar {
      flex-direction: column;
      gap: 10px;
    }
    
    .el-table {
      font-size: 12px;
    }
  }
}
```

### 4.2 移动端组件
```vue
<!-- MobileNavbar.vue -->
<template>
  <div class="mobile-navbar">
    <el-button :icon="Menu" @click="toggleSidebar" />
    <span class="title">{{ title }}</span>
    <el-button :icon="Bell" />
  </div>
</template>
```

---

**文档版本**: v1.0  
**创建日期**: 2025-01-13  
**更新日期**: 2025-01-13  
**文档状态**: 初稿
